<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>列車シャッタースピード計算</title>

<style>
body{
  font-family: sans-serif;
  max-width: 600px;
  margin: 0 auto;
  padding: 20px 16px;
  line-height: 1.8;
  font-size: 17px;
}

h2{
  font-size: 20px;
  margin-bottom: 18px;
}

.section{
  background:#f6f6f6;
  border-radius:12px;
  padding:14px;
  margin-bottom:20px;
}

input, select{
  width:100%;
  font-size:18px;
  padding:10px;
  margin-top:6px;
  margin-bottom:14px;
  box-sizing:border-box;
}

button{
  width:100%;
  font-size:20px;
  padding:14px;
  border-radius:10px;
}

.result{
  margin-top:20px;
  font-size:26px;
  font-weight:bold;
}

.note{
  margin-top:14px;
  font-size:13px;
  color:#666;
}

/* ★ 1行チェックボックス */
.inlineCheck{
  display:flex;
  align-items:center;
  gap:8px;
  font-size:14px;
  margin-top:-6px;
  margin-bottom:14px;
}
  .inlineCheck input{
  width:auto;
}
</style>
</head>

<body>

<h2>鉄道シャッタースピード計算</h2>


<!-- ===============================
     カメラ設定（常時表示）
================================ -->
<div class="section">

  メーカー
  <select id="brand"></select>

  機種
  <select id="model"></select>

  カメラの横ピクセル数(px)
  <input id="pixel" type="number">

  <label class="inlineCheck">
    <input type="checkbox" id="manual">
    ピクセル数を手動入力する
  </label>

</div>



列車速度(km/h)
<input id="speed" type="number">

画角の横幅(m)
<input id="width" type="number" step="0.1">

<button onclick="calc()">計算する</button>

<div class="result" id="result"></div>


<div class="note">
※ピクセル数が間違っている場合手動入力してください<br>
※手ブレがなく列車が真横に移動する際の理論値です<br>

作者X：
<a href="https://x.com/jo_taku150?s=21" target="_blank">
  @jo_taku150
</a>
（お気づきの点があればXまで）

</div>



<script>
/* ===============================
   カメラデータ
=============================== */

const cameraData = {

  Canon: {
    "EOS R5 / R5 Mark II": 8192,
    "EOS R6 / R6 Mark II": 6000,
    "EOS R7 (APS-C)": 6960,
    "EOS R10 / R50 (APS-C)": 6000,
    "EOS RP": 6240,
    "EOS 90D": 6960
  },

  Nikon: {
    "Z9 / Z8 / Z7 II": 8256,
    "Z6 III / Z6 II / Z5 II": 6048,
    "Z5": 6016,
    "Z50 / Z fc (APS-C)": 5568,
    "D850": 8256,
    "D500 / D7500": 5568
  },

  SONY: {
    "α1 / α1 II": 8640,
    "α7R V / α7R IV / α7CR": 9504,
    "α7 IV / α7C II": 7008,
    "α7 III / α9系": 6000,
    "α7S III": 4240,
    "α6700": 6192,
    "α6600 / α6400": 6000
  }
};


/* ===============================
   DOM
=============================== */

const brandSel = document.getElementById("brand");
const modelSel = document.getElementById("model");
const pixelInput = document.getElementById("pixel");
const manual = document.getElementById("manual");

const STORAGE_KEY = "cameraSetting";


/* ===============================
   セレクト生成
=============================== */

Object.keys(cameraData).forEach(b=>{
  brandSel.add(new Option(b,b));
});

function updateModels(){
  modelSel.innerHTML = "";

  Object.entries(cameraData[brandSel.value]).forEach(([name,px])=>{
    const opt = new Option(name,name);
    opt.dataset.px = px;
    modelSel.add(opt);
  });

  updatePixel();
}

function updatePixel(){
  if(!manual.checked){
    pixelInput.value =
      modelSel.selectedOptions[0].dataset.px;
  }
}


/* ===============================
   保存（自動記憶）
=============================== */

function saveSetting(){
  const s = {
    brand: brandSel.value,
    model: modelSel.value,
    pixel: pixelInput.value,
    manual: manual.checked
  };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(s));
}

function loadSetting(){
  const saved = localStorage.getItem(STORAGE_KEY);
  if(!saved) return;

  const s = JSON.parse(saved);

  brandSel.value = s.brand;
  updateModels();
  modelSel.value = s.model;

  manual.checked = s.manual;
  pixelInput.disabled = !s.manual;
  pixelInput.value = s.pixel;
}


/* ===============================
   イベント
=============================== */

brandSel.onchange = ()=>{
  updateModels();
  saveSetting();
};

modelSel.onchange = ()=>{
  updatePixel();
  saveSetting();
};

manual.onchange = ()=>{
  pixelInput.disabled = !manual.checked;
  updatePixel();
  saveSetting();
};

pixelInput.oninput = saveSetting;


/* 初期化 */
updateModels();
loadSetting();


/* ===============================
   計算
=============================== */

function calc() {

  const kmh = Number(document.getElementById("speed").value);
  const width = Number(document.getElementById("width").value);
  const px = Number(document.getElementById("pixel").value);

  if(!kmh || !width || !px){
    document.getElementById("result").textContent = "数値を入力してください";
    return;
  }

  const speed = kmh / 3.6;
  const time = width / speed;
  const tPixel = time / px;
  const shutter = 1 / tPixel;

  const rounded = Math.round(shutter / 100) * 100;

  document.getElementById("result").textContent =
    `必要シャッター速度： 1/${rounded} 秒`;
}
</script>

</body>
</html>
